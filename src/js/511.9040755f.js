"use strict";(self["webpackChunkmy_ai"]=self["webpackChunkmy_ai"]||[]).push([[511],{5511:function(t,r,a){a.r(r),a.d(r,{CompressedGaussianSplats:function(){return X},GSplineBuffer:function(){return Pa},GaussianPLYData:function(){return Z}});a(4114),a(8111),a(2489),a(7588),a(1701);var e=Object.create,n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,o=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,u=(t,r,a)=>r in t?n(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,l=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),c=(t,r)=>{for(var a in r)n(t,a,{get:r[a],enumerable:!0})},f=(t,r,a,e)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let o of i(r))!h.call(t,o)&&o!==a&&n(t,o,{get:()=>r[o],enumerable:!(e=s(r,o))||e.enumerable});return t},p=(t,r,a)=>(a=null!=t?e(o(t)):{},f(!r&&t&&t.__esModule?a:n(a,"default",{value:t,enumerable:!0}),t)),d=(t,r,a)=>(u(t,"symbol"!=typeof r?r+"":r,a),a),y=l(((t,r)=>{function a(t){for(var r=new Array(t),a=0;a<t;++a)r[a]=a;return r}r.exports=a})),g=l(((t,r)=>{function a(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function e(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&a(t.slice(0,0))}r.exports=function(t){return null!=t&&(a(t)||e(t)||!!t._isBuffer)}})),m=l(((t,r)=>{var a=y(),e=g(),n=typeof Float64Array<"u";function s(t,r){return t[0]-r[0]}function i(){var t,r=this.stride,a=new Array(r.length);for(t=0;t<a.length;++t)a[t]=[Math.abs(r[t]),t];a.sort(s);var e=new Array(a.length);for(t=0;t<e.length;++t)e[t]=a[t][1];return e}function o(t,r){var e=["View",r,"d",t].join("");r<0&&(e="View_Nil"+t);var n="generic"===t;if(-1===r){var s="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}",o=new Function(s);return o()}if(0===r){s="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}",o=new Function("TrivialArray",s);return o(u[t][0])}s=["'use strict'"];var h=a(r),l=h.map((function(t){return"i"+t})),c="this.offset+"+h.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),f=h.map((function(t){return"b"+t})).join(","),p=h.map((function(t){return"c"+t})).join(",");s.push("function "+e+"(a,"+f+","+p+",d){this.data=a","this.shape=["+f+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+t+"'","proto.dimension="+r),s.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+h.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===r?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),r<4?(s.push("function "+e+"_order(){"),2===r?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+e+"_set("+l.join(",")+",v){"),n?s.push("return this.data.set("+c+",v)}"):s.push("return this.data["+c+"]=v}"),s.push("proto.get=function "+e+"_get("+l.join(",")+"){"),n?s.push("return this.data.get("+c+")}"):s.push("return this.data["+c+"]}"),s.push("proto.index=function "+e+"_index(",l.join(),"){return "+c+"}"),s.push("proto.hi=function "+e+"_hi("+l.join(",")+"){return new "+e+"(this.data,"+h.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+h.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var d=h.map((function(t){return"a"+t+"=this.shape["+t+"]"})),y=h.map((function(t){return"c"+t+"=this.stride["+t+"]"}));s.push("proto.lo=function "+e+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+y.join(","));for(var g=0;g<r;++g)s.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");s.push("return new "+e+"(this.data,"+h.map((function(t){return"a"+t})).join(",")+","+h.map((function(t){return"c"+t})).join(",")+",b)}"),s.push("proto.step=function "+e+"_step("+l.join(",")+"){var "+h.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+h.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<r;++g)s.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");s.push("return new "+e+"(this.data,"+h.map((function(t){return"a"+t})).join(",")+","+h.map((function(t){return"b"+t})).join(",")+",c)}");var m=new Array(r),b=new Array(r);for(g=0;g<r;++g)m[g]="a[i"+g+"]",b[g]="b[i"+g+"]";s.push("proto.transpose=function "+e+"_transpose("+l+"){"+l.map((function(t,r){return t+"=("+t+"===undefined?"+r+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+m.join(",")+","+b.join(",")+",this.offset)}"),s.push("proto.pick=function "+e+"_pick("+l+"){var a=[],b=[],c=this.offset");for(g=0;g<r;++g)s.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+h.map((function(t){return"shape["+t+"]"})).join(",")+","+h.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}");o=new Function("CTOR_LIST","ORDER",s.join("\n"));return o(u[t],i)}function h(t){if(e(t))return"buffer";if(n)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function l(t,r,a,e){if(void 0===t){var n=u.array[0];return n([])}"number"==typeof t&&(t=[t]),void 0===r&&(r=[t.length]);var s=r.length;if(void 0===a){a=new Array(s);for(var i=s-1,l=1;i>=0;--i)a[i]=l,l*=r[i]}if(void 0===e){e=0;for(i=0;i<s;++i)a[i]<0&&(e-=(r[i]-1)*a[i])}for(var c=h(t),f=u[c];f.length<=s+1;)f.push(o(c,f.length-1));n=f[s+1];return n(t,r,a,e)}r.exports=l})),b=l(((t,r)=>{function a(t,r){for(var a=1,e=t.length,n=t[0],s=t[0],i=1;i<e;++i)if(s=n,n=t[i],r(n,s)){if(i===a){a++;continue}t[a++]=n}return t.length=a,t}function e(t){for(var r=1,a=t.length,e=t[0],n=t[0],s=1;s<a;++s,n=e)if(n=e,e=t[s],e!==n){if(s===r){r++;continue}t[r++]=e}return t.length=r,t}function n(t,r,n){return 0===t.length?t:r?(n||t.sort(r),a(t,r)):(n||t.sort(),e(t))}r.exports=n})),_=l(((t,r)=>{var a=b();function e(t,r,a){var e,n,s=t.length,i=r.arrayArgs.length,o=r.indexArgs.length>0,h=[],u=[],l=0,c=0;for(e=0;e<s;++e)u.push(["i",e,"=0"].join(""));for(n=0;n<i;++n)for(e=0;e<s;++e)c=l,l=t[e],0===e?u.push(["d",n,"s",e,"=t",n,"p",l].join("")):u.push(["d",n,"s",e,"=(t",n,"p",l,"-s",c,"*t",n,"p",c,")"].join(""));for(u.length>0&&h.push("var "+u.join(",")),e=s-1;e>=0;--e)l=t[e],h.push(["for(i",e,"=0;i",e,"<s",l,";++i",e,"){"].join(""));for(h.push(a),e=0;e<s;++e){for(c=l,l=t[e],n=0;n<i;++n)h.push(["p",n,"+=d",n,"s",e].join(""));o&&(e>0&&h.push(["index[",c,"]-=s",c].join("")),h.push(["++index[",l,"]"].join(""))),h.push("}")}return h.join("\n")}function n(t,r,a,n){for(var s=r.length,i=a.arrayArgs.length,o=a.blockSize,h=a.indexArgs.length>0,u=[],l=0;l<i;++l)u.push(["var offset",l,"=p",l].join(""));for(l=t;l<s;++l)u.push(["for(var j"+l+"=SS[",r[l],"]|0;j",l,">0;){"].join("")),u.push(["if(j",l,"<",o,"){"].join("")),u.push(["s",r[l],"=j",l].join("")),u.push(["j",l,"=0"].join("")),u.push(["}else{s",r[l],"=",o].join("")),u.push(["j",l,"-=",o,"}"].join("")),h&&u.push(["index[",r[l],"]=j",l].join(""));for(l=0;l<i;++l){for(var c=["offset"+l],f=t;f<s;++f)c.push(["j",f,"*t",l,"p",r[f]].join(""));u.push(["p",l,"=(",c.join("+"),")"].join(""))}u.push(e(r,a,n));for(l=t;l<s;++l)u.push("}");return u.join("\n")}function s(t){for(var r=0,a=t[0].length;r<a;){for(var e=1;e<t.length;++e)if(t[e][r]!==t[0][r])return r;++r}return r}function i(t,r,a){for(var e=t.body,n=[],s=[],i=0;i<t.args.length;++i){var o=t.args[i];if(!(o.count<=0)){var h=new RegExp(o.name,"g"),u="",l=r.arrayArgs.indexOf(i);switch(r.argTypes[i]){case"offset":var c=r.offsetArgIndex.indexOf(i),f=r.offsetArgs[c];l=f.array,u="+q"+c;case"array":u="p"+l+u;var p="l"+i,d="a"+l;if(0===r.arrayBlockIndices[l])1===o.count?"generic"===a[l]?o.lvalue?(n.push(["var ",p,"=",d,".get(",u,")"].join("")),e=e.replace(h,p),s.push([d,".set(",u,",",p,")"].join(""))):e=e.replace(h,[d,".get(",u,")"].join("")):e=e.replace(h,[d,"[",u,"]"].join("")):"generic"===a[l]?(n.push(["var ",p,"=",d,".get(",u,")"].join("")),e=e.replace(h,p),o.lvalue&&s.push([d,".set(",u,",",p,")"].join(""))):(n.push(["var ",p,"=",d,"[",u,"]"].join("")),e=e.replace(h,p),o.lvalue&&s.push([d,"[",u,"]=",p].join("")));else{for(var y=[o.name],g=[u],m=0;m<Math.abs(r.arrayBlockIndices[l]);m++)y.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(m+1)+"*t"+l+"b"+m);if(h=new RegExp(y.join(""),"g"),u=g.join("+"),"generic"===a[l])throw new Error("cwise: Generic arrays not supported in combination with blocks!");e=e.replace(h,[d,"[",u,"]"].join(""))}break;case"scalar":e=e.replace(h,"Y"+r.scalarArgs.indexOf(i));break;case"index":e=e.replace(h,"index");break;case"shape":e=e.replace(h,"shape");break}}}return[n.join("\n"),e,s.join("\n")].join("\n").trim()}function o(t){for(var r=new Array(t.length),a=!0,e=0;e<t.length;++e){var n=t[e],s=n.match(/\d+/);s=s?s[0]:"",0===n.charAt(0)?r[e]="u"+n.charAt(1)+s:r[e]=n.charAt(0)+s,e>0&&(a=a&&r[e]===r[e-1])}return a?r[0]:r.join("")}function h(t,r){for(var h=r[1].length-Math.abs(t.arrayBlockIndices[0])|0,u=new Array(t.arrayArgs.length),l=new Array(t.arrayArgs.length),c=0;c<t.arrayArgs.length;++c)l[c]=r[2*c],u[c]=r[2*c+1];var f=[],p=[],d=[],y=[],g=[];for(c=0;c<t.arrayArgs.length;++c){t.arrayBlockIndices[c]<0?(d.push(0),y.push(h),f.push(h),p.push(h+t.arrayBlockIndices[c])):(d.push(t.arrayBlockIndices[c]),y.push(t.arrayBlockIndices[c]+h),f.push(0),p.push(t.arrayBlockIndices[c]));for(var m=[],b=0;b<u[c].length;b++)d[c]<=u[c][b]&&u[c][b]<y[c]&&m.push(u[c][b]-d[c]);g.push(m)}var _=["SS"],v=["'use strict'"],M=[];for(b=0;b<h;++b)M.push(["s",b,"=SS[",b,"]"].join(""));for(c=0;c<t.arrayArgs.length;++c){_.push("a"+c),_.push("t"+c),_.push("p"+c);for(b=0;b<h;++b)M.push(["t",c,"p",b,"=t",c,"[",d[c]+b,"]"].join(""));for(b=0;b<Math.abs(t.arrayBlockIndices[c]);++b)M.push(["t",c,"b",b,"=t",c,"[",f[c]+b,"]"].join(""))}for(c=0;c<t.scalarArgs.length;++c)_.push("Y"+c);if(t.shapeArgs.length>0&&M.push("shape=SS.slice(0)"),t.indexArgs.length>0){var w=new Array(h);for(c=0;c<h;++c)w[c]="0";M.push(["index=[",w.join(","),"]"].join(""))}for(c=0;c<t.offsetArgs.length;++c){var x=t.offsetArgs[c],k=[];for(b=0;b<x.offset.length;++b)0!==x.offset[b]&&(1===x.offset[b]?k.push(["t",x.array,"p",b].join("")):k.push([x.offset[b],"*t",x.array,"p",b].join("")));0===k.length?M.push("q"+c+"=0"):M.push(["q",c,"=",k.join("+")].join(""))}var A=a([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));M=M.concat(A),M.length>0&&v.push("var "+M.join(","));for(c=0;c<t.arrayArgs.length;++c)v.push("p"+c+"|=0");t.pre.body.length>3&&v.push(i(t.pre,t,l));var q=i(t.body,t,l),z=s(g);z<h?v.push(n(z,g[0],t,q)):v.push(e(g[0],t,q)),t.post.body.length>3&&v.push(i(t.post,t,l)),t.debug&&console.log("-----Generated cwise routine for ",r,":\n"+v.join("\n")+"\n----------");var j=[t.funcName||"unnamed","_cwise_loop_",u[0].join("s"),"m",z,o(l)].join(""),V=new Function(["function ",j,"(",_.join(","),"){",v.join("\n"),"} return ",j].join(""));return V()}r.exports=h})),v=l(((t,r)=>{var a=_();function e(t){var r=["'use strict'","var CACHED={}"],e=[],n=t.funcName+"_cwise_thunk";r.push(["return function ",n,"(",t.shimArgs.join(","),"){"].join(""));for(var s=[],i=[],o=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],h=[],u=[],l=0;l<t.arrayArgs.length;++l){var c=t.arrayArgs[l];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),s.push("t"+c),s.push("r"+c),i.push("t"+c),i.push("r"+c+".join()"),o.push("array"+c+".data"),o.push("array"+c+".stride"),o.push("array"+c+".offset|0"),l>0&&(h.push("array"+t.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[l]))),u.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[l])+"]"))}t.arrayArgs.length>1&&(r.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),r.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),r.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),r.push("}"));for(l=0;l<t.scalarArgs.length;++l)o.push("scalar"+t.scalarArgs[l]);e.push(["type=[",i.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),r.push("var "+e.join(",")),r.push(["if(!proc){","CACHED[type]=proc=compile([",s.join(","),"])}","return proc(",o.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+r.join("\n")+"\n----------");var f=new Function("compile",r.join("\n"));return f(a.bind(void 0,t))}r.exports=e})),M=l(((t,r)=>{var a=v();function e(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function n(t){var r=new e;r.pre=t.pre,r.body=t.body,r.post=t.post;var n=t.args.slice(0);r.argTypes=n;for(var s=0;s<n.length;++s){var i=n[s];if("array"===i||"object"==typeof i&&i.blockIndices){if(r.argTypes[s]="array",r.arrayArgs.push(s),r.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),r.shimArgs.push("array"+s),s<r.pre.args.length&&r.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array args");if(s<r.post.args.length&&r.post.args[s].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)r.scalarArgs.push(s),r.shimArgs.push("scalar"+s);else if("index"===i){if(r.indexArgs.push(s),s<r.pre.args.length&&r.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array index");if(s<r.body.args.length&&r.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array index");if(s<r.post.args.length&&r.post.args[s].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(r.shapeArgs.push(s),s<r.pre.args.length&&r.pre.args[s].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(s<r.body.args.length&&r.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array shape");if(s<r.post.args.length&&r.post.args[s].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+n[s]);r.argTypes[s]="offset",r.offsetArgs.push({array:i.array,offset:i.offset}),r.offsetArgIndex.push(s)}}if(r.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(r.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(r.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(r.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return r.debug=!!t.printCode||!!t.debug,r.funcName=t.funcName||"cwise",r.blockSize=t.blockSize||64,a(r)}r.exports=n})),w=l((t=>{var r=M(),a={body:"",args:[],thisVars:[],localVars:[]};function e(t){if(!t)return a;for(var r=0;r<t.args.length;++r){var e=t.args[r];t.args[r]=0===r?{name:e,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:e,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function n(t){return r({args:t.args,pre:e(t.pre),body:e(t.body),post:e(t.proc),funcName:t.funcName})}function s(t){for(var r=[],a=0;a<t.args.length;++a)r.push("a"+a);var e=new Function("P",["return function ",t.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return e(n(t))}var i={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var r in i){var a=i[r];t[r]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+a+"c"},funcName:r}),t[r+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+a+"=b"},rvalue:!0,funcName:r+"eq"}),t[r+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+a+"s"},funcName:r+"s"}),t[r+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+a+"=s"},rvalue:!0,funcName:r+"seq"})}})();var o={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var r in o){var a=o[r];t[r]=s({args:["array","array"],body:{args:["a","b"],body:"a="+a+"b"},funcName:r}),t[r+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+a+"a"},rvalue:!0,count:2,funcName:r+"eq"})}})();var h={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var r in h){var a=h[r];t[r]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+a+"c"},funcName:r}),t[r+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+a+"s"},funcName:r+"s"}),t[r+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+a+"b"},rvalue:!0,count:2,funcName:r+"eq"}),t[r+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+a+"s"},rvalue:!0,count:2,funcName:r+"seq"})}})();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var r=0;r<u.length;++r){var a=u[r];t[a]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:a}),t[a+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:a+"eq"})}})();var l=["max","min","atan2","pow"];(function(){for(var r=0;r<l.length;++r){var a=l[r];t[a]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:a}),t[a+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:a+"s"}),t[a+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:a+"eq"}),t[a+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:a+"seq"})}})();var c=["atan2","pow"];(function(){for(var r=0;r<c.length;++r){var a=c[r];t[a+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:a+"op"}),t[a+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:a+"ops"}),t[a+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:a+"opeq"}),t[a+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+a,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:a+"opseq"})}})(),t.any=r({args:["array"],pre:a,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=r({args:["array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=r({args:["array","array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})})),x=p(m(),1),k=p(w(),1),A=p(m(),1),q=p(w(),1),z=class{constructor(t,r,a){this._dataNormalized=t,this._minD=r,this._maxD=a}static createFromUnnormalized(t){let r=q.sup(t),a=q.inf(t),e=(0,A.default)(new Float32Array(t.size),t.shape),n=r-a;return n<1e-4?q.assigns(e,0):(q.subs(e,t,a),q.divs(e,e,n)),new z(e,a,r)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let t=(0,A.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return q.muls(t,this._dataNormalized,this._maxD-this._minD),q.adds(t,t,this._minD),t}},j=class{constructor(t,r){this._quantized=t,this._method=r}get quantized(){return this._quantized}static maxIntBits(t){return 2**t-1}static fromNormalized(t,r){let a,e=t.data;if("norm8x"===r){let t=j.maxIntBits(8),r=(0,A.default)(new Float32Array(e.size),e.shape);q.muls(r,e,t),q.roundeq(r),a=(0,A.default)(new Uint8Array(r.data),e.shape)}else if("norm565"===r){let t=(0,A.default)(new Float32Array(e.size),e.shape);q.assign(t,e),q.mulseq(t.pick(null,0),j.maxIntBits(5)),q.mulseq(t.pick(null,1),j.maxIntBits(6)),q.mulseq(t.pick(null,2),j.maxIntBits(5)),q.roundeq(t);let r=(0,A.default)(new Uint16Array(t.data),e.shape),n=(0,A.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),s=(0,A.default)(new Uint16Array(e.shape[0]),[e.shape[0]]);q.lshifts(n,r.pick(null,0),11),q.lshifts(s,r.pick(null,1),5),q.boreq(n,s),q.boreq(n,r.pick(null,2)),a=n}else{let t=(0,A.default)(new Float32Array(e.size),e.shape);q.assign(t,e),q.mulseq(t.pick(null,0),j.maxIntBits(11)),q.mulseq(t.pick(null,1),j.maxIntBits(10)),q.mulseq(t.pick(null,2),j.maxIntBits(11)),q.roundeq(t);let r=(0,A.default)(new Uint32Array(t.data),e.shape),n=(0,A.default)(new Uint32Array(e.shape[0]),[e.shape[0]]),s=(0,A.default)(new Uint32Array(e.shape[0]),[e.shape[0]]);q.lshifts(n,r.pick(null,0),21),q.lshifts(s,r.pick(null,1),11),q.boreq(n,s),q.boreq(n,r.pick(null,2)),a=n}return new j(a,r)}dequantize(t,r){let a,e=this._method,n=this._quantized;if("norm8x"===e){let t=j.maxIntBits(8);a=(0,A.default)(new Float32Array(n.size),n.shape),q.muls(a,n,1/t)}else if("norm565"===e){let t=(0,A.default)(new Uint8Array(n.shape[0]),[n.shape[0]]),r=(0,A.default)(new Uint8Array(n.shape[0]),[n.shape[0]]),e=(0,A.default)(new Uint8Array(n.shape[0]),[n.shape[0]]);q.rrshifts(t,n,11),q.rrshifts(r,n,5),q.bandseq(r,j.maxIntBits(6)),q.bands(e,n,j.maxIntBits(5)),a=(0,A.default)(new Float32Array(3*n.shape[0]),[n.shape[0],3]),q.muls(a.pick(null,0),t,1/j.maxIntBits(5)),q.muls(a.pick(null,1),r,1/j.maxIntBits(6)),q.muls(a.pick(null,2),e,1/j.maxIntBits(5))}else{let t=(0,A.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),r=(0,A.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),e=(0,A.default)(new Uint16Array(n.shape[0]),[n.shape[0]]);q.rrshifts(t,n,21),q.rrshifts(r,n,11),q.bandseq(r,j.maxIntBits(10)),q.bands(e,n,j.maxIntBits(11)),a=(0,A.default)(new Float32Array(3*n.shape[0]),[n.shape[0],3]),q.muls(a.pick(null,0),t,1/j.maxIntBits(11)),q.muls(a.pick(null,1),r,1/j.maxIntBits(10)),q.muls(a.pick(null,2),e,1/j.maxIntBits(11))}return new z(a,t,r)}},V=class{constructor(t,r,a,e,n,s=!1){this._quantized=t,this._minMaxMatrix=r,this._chunkSize=a,this._quantizationMethod=e,this._variableChunkSize=n,this._isDynamicChunks=s}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(t){let r=t.length,a=this.minmaxMatrix.shape[0]-r,e=(0,x.default)(new Float32Array(2*a),[a,2]),n=0,s=a,i=0,o=this.minmaxMatrix.shape[0];for(let h=0;h<t.length;h++)o=t[h],s=o-i+n,s>n&&k.assign(e.hi(s,2).lo(n,0),this.minmaxMatrix.hi(o,2).lo(i,0)),n=s,i=o+1;return n<a&&k.assign(e.lo(n,0),this.minmaxMatrix.lo(i,0)),e}_createPrunedQuantized(t){let r,a,e=t.length,n=this.quantized.shape[0]-e,s=this._quantizationMethod;if("norm8x"===s){a=this._quantized.shape[1];let t=a?n*a:n;r=(0,x.default)(new Uint8Array(t),a?[n,a]:[n,1])}else r="norm565"===s?(0,x.default)(new Uint16Array(n),[n]):(0,x.default)(new Uint32Array(n),[n]);let i=0,o=n,h=0,u=r.shape[0];for(let l=0;l<t.length;l++)u=t[l],o=u-h+i,o>i&&(a?k.assign(r.hi(o,a).lo(i,0),this._quantized.hi(u,a).lo(h,0)):k.assign(r.hi(o).lo(i),this._quantized.hi(u).lo(h))),i=o,h=u+1;return i<n&&(a?k.assign(r.lo(i,0),this._quantized.lo(h,0)):k.assign(r.lo(i),this._quantized.lo(h))),r}pruneFeature(t,r,a){let e=this._createPrunedQuantized(t),n=this._createPrunedMinMax(r);return new V(e,n,this._chunkSize,this._quantizationMethod,a,!0)}static getRequiredNChunks(t,r){return Math.floor(t/r)}static fromArray(t,r,a){let e,n=t.shape[0],s=Math.floor(n/a),i=(0,x.default)(new Float32Array(2*s),[s,2],[2,1]);e="norm8x"===r?(0,x.default)(new Uint8Array(t.size),t.shape):"norm565"===r?(0,x.default)(new Uint16Array(t.shape[0]),[t.shape[0]]):(0,x.default)(new Uint32Array(t.shape[0]),[t.shape[0]]);for(let o=0;o<s;o++){let h,u=o*a,l=o+1<s?(o+1)*a:n;h=t.shape.length>1?z.createFromUnnormalized(t.hi(l,t.shape[1]).lo(u,0)):z.createFromUnnormalized(t.hi(l).lo(u)),i.set(o,0,h.minD),i.set(o,1,h.maxD),e.shape.length>1?k.assign(e.hi(l,e.shape[1]).lo(u,0),j.fromNormalized(h,r).quantized):k.assign(e.hi(l).lo(u),j.fromNormalized(h,r).quantized)}return new V(e,i,a,r)}denormDequant(){let t,r,a=this._minMaxMatrix.shape[0],e=this._quantized,n=e.shape[0],s=this._quantizationMethod,i=this._chunkSize;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");t=this._variableChunkSize}r="norm8x"===s?(0,x.default)(new Float32Array(e.size),e.shape):(0,x.default)(new Float32Array(3*n),[n,3]);let o=0,h=i;for(let u=0;u<a;u++){let[i,l]=[this._minMaxMatrix.get(u,0),this._minMaxMatrix.get(u,1)];this._isDynamicChunks&&(h=t[u]);let c,f=u+1<a?o+h:n;c=e.shape.length>1?new j(e.hi(f,e.shape[1]).lo(o,0),s):new j(e.hi(f).lo(o),s),k.assign(r.hi(f,r.shape[1]).lo(o,0),c.dequantize(i,l).denormalize()),o=f}return r}static async fetchArrayBuffer(t){return await(await fetch(t,{mode:"cors"})).arrayBuffer()}},S=p(m(),1),I=p(w(),1),D="http://127.0.0.1:8000",F=p(m(),1),B=p(w(),1),N=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function U(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function C(t,r){if(t===r)return 0;if(~~t===t&&~~r===r){if(0===t||0===r)return t<r?-1:1;if(t<0||r<0){if(r>=0)return-1;if(t>=0)return 1;t=-t,r=-r}let a=U(t),e=U(r),n=0;return a<e?(t*=N[e-a-1],r/=10,n=-1):a>e&&(r*=N[a-e-1],t/=10,n=1),t===r?n:t<r?-1:1}let a=String(t),e=String(r);return a===e?0:a<e?-1:1}function L(t){let r=0;for(;t>=32;)r|=1&t,t>>=1;return t+r}function E(t,r,a,e){let n=r+1;if(n===a)return 1;if(e(t[n++],t[r])<0){for(;n<a&&e(t[n],t[n-1])<0;)n++;O(t,r,n)}else for(;n<a&&e(t[n],t[n-1])>=0;)n++;return n-r}function O(t,r,a){for(a--;r<a;){let e=t[r];t[r++]=t[a],t[a--]=e}}function $(t,r,a,e,n){for(e===r&&e++;e<a;e++){let a=t[e],s=r,i=e;for(;s<i;){let r=s+i>>>1;n(a,t[r])<0?i=r:s=r+1}let o=e-s;switch(o){case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;o>0;)t[s+o]=t[s+o-1],o--}t[s]=a}}function P(t,r,a,e,n,s){let i=0,o=0,h=1;if(s(t,r[a+n])>0){for(o=e-n;h<o&&s(t,r[a+n+h])>0;)i=h,h=1+(h<<1),h<=0&&(h=o);h>o&&(h=o),i+=n,h+=n}else{for(o=n+1;h<o&&s(t,r[a+n-h])<=0;)i=h,h=1+(h<<1),h<=0&&(h=o);h>o&&(h=o);let e=i;i=n-h,h=n-e}for(i++;i<h;){let e=i+(h-i>>>1);s(t,r[a+e])>0?i=e+1:h=e}return h}function T(t,r,a,e,n,s){let i=0,o=0,h=1;if(s(t,r[a+n])<0){for(o=n+1;h<o&&s(t,r[a+n-h])<0;)i=h,h=1+(h<<1),h<=0&&(h=o);h>o&&(h=o);let e=i;i=n-h,h=n-e}else{for(o=e-n;h<o&&s(t,r[a+n+h])>=0;)i=h,h=1+(h<<1),h<=0&&(h=o);h>o&&(h=o),i+=n,h+=n}for(i++;i<h;){let e=i+(h-i>>>1);s(t,r[a+e])<0?h=e:i=e+1}return h}var R=class{constructor(t,r){d(this,"array",null),d(this,"compare",null),d(this,"minGallop",7),d(this,"length",0),d(this,"tmpStorageLength",256),d(this,"stackLength",0),d(this,"runStart",null),d(this,"runLength",null),d(this,"stackSize",0),this.array=t,this.compare=r,this.length=t.length,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(t,r){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=r,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;if(t>=1&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||t>=2&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}}forceMergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;t>0&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}}mergeAt(t){let r=this.compare,a=this.array,e=this.runStart[t],n=this.runLength[t],s=this.runStart[t+1],i=this.runLength[t+1];this.runLength[t]=n+i,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;let o=T(a[s],a,e,n,0,r);e+=o,n-=o,0!==n&&(i=P(a[e+n-1],a,s,i,i-1,r),0!==i&&(n<=i?this.mergeLow(e,n,s,i):this.mergeHigh(e,n,s,i)))}mergeLow(t,r,a,e){let n=this.compare,s=this.array,i=this.tmp,o=0;for(o=0;o<r;o++)i[o]=s[t+o];let h=0,u=a,l=t;if(s[l++]=s[u++],0===--e){for(o=0;o<r;o++)s[l+o]=i[h+o];return}if(1===r){for(o=0;o<e;o++)s[l+o]=s[u+o];return void(s[l+e]=i[h])}let c=this.minGallop;for(;;){let t=0,a=0,f=!1;do{if(n(s[u],i[h])<0){if(s[l++]=s[u++],a++,t=0,0===--e){f=!0;break}}else if(s[l++]=i[h++],t++,a=0,1===--r){f=!0;break}}while((t|a)<c);if(f)break;do{if(t=T(s[u],i,h,r,0,n),0!==t){for(o=0;o<t;o++)s[l+o]=i[h+o];if(l+=t,h+=t,r-=t,r<=1){f=!0;break}}if(s[l++]=s[u++],0===--e){f=!0;break}if(a=P(i[h],s,u,e,0,n),0!==a){for(o=0;o<a;o++)s[l+o]=s[u+o];if(l+=a,u+=a,e-=a,0===e){f=!0;break}}if(s[l++]=i[h++],1===--r){f=!0;break}c--}while(t>=7||a>=7);if(f)break;c<0&&(c=0),c+=2}if(this.minGallop=c,c<1&&(this.minGallop=1),1===r){for(o=0;o<e;o++)s[l+o]=s[u+o];s[l+e]=i[h]}else{if(0===r)throw new Error("mergeLow preconditions were not respected");for(o=0;o<r;o++)s[l+o]=i[h+o]}}mergeHigh(t,r,a,e){let n=this.compare,s=this.array,i=this.tmp,o=0;for(o=0;o<e;o++)i[o]=s[a+o];let h=t+r-1,u=e-1,l=a+e-1,c=0,f=0;if(s[l--]=s[h--],0===--r){for(c=l-(e-1),o=0;o<e;o++)s[c+o]=i[o];return}if(1===e){for(l-=r,h-=r,f=l+1,c=h+1,o=r-1;o>=0;o--)s[f+o]=s[c+o];return void(s[l]=i[u])}let p=this.minGallop;for(;;){let a=0,d=0,y=!1;do{if(n(i[u],s[h])<0){if(s[l--]=s[h--],a++,d=0,0===--r){y=!0;break}}else if(s[l--]=i[u--],d++,a=0,1===--e){y=!0;break}}while((a|d)<p);if(y)break;do{if(a=r-T(i[u],s,t,r,r-1,n),0!==a){for(l-=a,h-=a,r-=a,f=l+1,c=h+1,o=a-1;o>=0;o--)s[f+o]=s[c+o];if(0===r){y=!0;break}}if(s[l--]=i[u--],1===--e){y=!0;break}if(d=e-P(s[h],i,0,e,e-1,n),0!==d){for(l-=d,u-=d,e-=d,f=l+1,c=u+1,o=0;o<d;o++)s[f+o]=i[c+o];if(e<=1){y=!0;break}}if(s[l--]=s[h--],0===--r){y=!0;break}p--}while(a>=7||d>=7);if(y)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),1===e){for(l-=r,h-=r,f=l+1,c=h+1,o=r-1;o>=0;o--)s[f+o]=s[c+o];s[l]=i[u]}else{if(0===e)throw new Error("mergeHigh preconditions were not respected");for(c=l-(e-1),o=0;o<e;o++)s[c+o]=i[o]}}};function G(t,r,a,e){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");r?"function"!=typeof r&&(e=a,a=r,r=C):r=C,a||(a=0),e||(e=t.length);let n=e-a;if(n<2)return;let s=0;if(n<32)return s=E(t,a,e,r),void $(t,a,e,a+s,r);let i=new R(t,r),o=L(n);do{if(s=E(t,a,e,r),s<o){let e=n;e>o&&(e=o),$(t,a,a+e,a+s,r),s=e}i.pushRun(a,s),i.mergeRuns(),n-=s,a+=s}while(0!==n);i.forceMergeRuns()}function H(t){let r=(0,F.default)(new Int32Array(t.shape[0]),[t.shape[0]]),a=(0,F.default)(new Int32Array(t.shape[0]),[t.shape[0]]);return B.bands(r,t,1023),B.lshifts(a,r,16),B.bxoreq(r,a),B.bandseq(r,4278190335),B.lshifts(a,r,8),B.bxoreq(r,a),B.bandseq(r,50393103),B.lshifts(a,r,4),B.bxoreq(r,a),B.bandseq(r,51130563),B.lshifts(a,r,2),B.bxoreq(r,a),B.bandseq(r,153391689),r}function W(t){let r=H(t.pick(null,0)),a=H(t.pick(null,1));B.lshiftseq(a,1);let e=H(t.pick(null,2));return B.lshiftseq(e,2),B.boreq(r,a),B.boreq(r,e),r}function Y(t,r){if(t.shape[0]!==r.shape[0])throw new Error("wrong length");let a=(0,F.default)(new Float32Array(t.size),t.shape,t.stride,t.offset);for(let e=0;e<r.shape[0];e++){let n=r.get(e);if(t.shape.length>1)for(let r=0;r<t.shape[1];r++)a.set(e,r,t.get(n,r));else a.set(e,t.get(n))}return a}function Q(t){let r=B.sup(t),a=B.inf(t),e=1e3/Math.min(1e3,r-a),n=(0,F.default)(new Float32Array(t.data),t.shape);B.mulseq(n,e);let s=(0,F.default)(new Int32Array(n.data),t.shape),i=W(s),o=Array.from(i.data).map(((t,r)=>[t,r]));G(o,((t,r)=>t[0]-r[0]));let h=o.map((([t,r])=>r));return(0,F.default)(Uint32Array.from(h))}var Z=class{constructor(t,r,a,e,n,s,i,o,h,u){this.propertyDescs=t,this.format=r,this.nsplats=a,this.xyz=e,this.colors=n,this.harmonics=s,this.opacity=i,this.scaling=o,this.rotation=h,this.maxSHDegree=u}getPlyBinary(){let t=Z._generateHeaderString(this.propertyDescs,this.format,this.nsplats),r=(new TextEncoder).encode(t),a=Object.keys(this.propertyDescs).length,e=(0,S.default)(new Float32Array(this.nsplats*a),[this.nsplats,a]);if(I.assign(e.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),I.assign(e.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),I.assign(e.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),I.assign(e.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),I.assign(e.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),I.assign(e.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),I.assign(e.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),I.assign(e.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),I.assign(e.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),I.assign(e.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),I.assign(e.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),I.assign(e.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),I.assign(e.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),I.assign(e.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let i=0;i<this.harmonics.length;i++){let t=3*i;I.assign(e.pick(null,this.propertyDescs[`f_rest_${t}`].index),this.harmonics[i].pick(null,0)),I.assign(e.pick(null,this.propertyDescs[`f_rest_${t+1}`].index),this.harmonics[i].pick(null,1)),I.assign(e.pick(null,this.propertyDescs[`f_rest_${t+2}`].index),this.harmonics[i].pick(null,2))}let n=new Uint8Array(e.data.buffer),s=new Uint8Array(n.length+r.length);return s.set(r),s.set(n,r.length),s.buffer}save(t,r){let a=this.getPlyBinary(),e=new Blob([a],{type:"application/octet-stream"}),n=new File([e],t),s=new FormData;s.append("file",n),s.append("filename",t),s.append("basedir",r),fetch(`${D}/push_file`,{method:"POST",body:s})}static async loadFile(t){return await(await fetch(t)).arrayBuffer()}mortonPositionSplatsSort(){let t=Q(this.xyz),r=Y(this.xyz,t),a=Y(this.colors,t),e=Y(this.opacity,t),n=Y(this.scaling,t),s=Y(this.rotation,t),i=[];for(let o=0;o<this.harmonics.length;o++)i.push(Y(this.harmonics[o],t));return new Z(this.propertyDescs,this.format,this.nsplats,r,a,i,e,n,s,this.maxSHDegree)}static _generateHeaderString(t,r,a){let e=`ply\nformat ${r.format} ${r.version}\nelement vertex ${a}`,n=Object.keys(t).length,s=Array(n);for(let i in t){let r=t[i];s[r.index]={name:i,dtype:r.dtype}}for(let i=0;i<s.length;i++)e=`${e}\nproperty ${s[i].dtype} ${s[i].name}`;return`${e}\nend_header\n`}static fromArrayBuffer(t,r=3){let{splatCount:a,vertexData:e,propertiesDesc:n,format:s}=Z.decodeHeader(t),i=e.buffer.slice(e.byteOffset),o=Object.keys(n).length,h=(0,S.default)(new Float32Array(i),[a,o]),u=0,l={},c={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let _ in n)if(n.hasOwnProperty(_)){let t=n[_].dtype;l[_]=u,u+=c[t]}let f=(0,S.default)(new Float32Array(3*a),[a,3]);I.assign(f.pick(null,0),h.pick(null,l.x/4)),I.assign(f.pick(null,1),h.pick(null,l.y/4)),I.assign(f.pick(null,2),h.pick(null,l.z/4));let p=(0,S.default)(new Float32Array(3*a),[a,3]);I.assign(p.pick(null,0),h.pick(null,l.scale_0/4)),I.assign(p.pick(null,1),h.pick(null,l.scale_1/4)),I.assign(p.pick(null,2),h.pick(null,l.scale_2/4));let d=(0,S.default)(new Float32Array(3*a),[a,3]);I.assign(d.pick(null,0),h.pick(null,l.f_dc_0/4)),I.assign(d.pick(null,1),h.pick(null,l.f_dc_1/4)),I.assign(d.pick(null,2),h.pick(null,l.f_dc_2/4));let y=(0,S.default)(new Float32Array(4*a),[a,4]);I.assign(y.pick(null,0),h.pick(null,l.rot_1/4)),I.assign(y.pick(null,1),h.pick(null,l.rot_2/4)),I.assign(y.pick(null,2),h.pick(null,l.rot_3/4)),I.assign(y.pick(null,3),h.pick(null,l.rot_0/4));for(let _=0;_<a;_++){let t=y.pick(_,null),r=Math.sqrt(t.get(0)**2+t.get(1)**2+t.get(2)**2+t.get(3)**2);I.divseq(t,r)}let g=(0,S.default)(new Float32Array(1*a),[a,1]);I.assign(g.pick(null,0),h.pick(null,l.opacity/4)),I.negeq(g),I.expeq(g),I.addseq(g,1),I.recipeq(g),I.mulseq(g,255);let m=(Math.min(Math.max(r,0),3)+1)**2-1,b=[];for(let _=0;_<m;_++){let t=(0,S.default)(new Float32Array(3*a),[a,3]),r=3*_;I.assign(t.pick(null,0),h.pick(null,l[`f_rest_${r}`]/4)),I.assign(t.pick(null,1),h.pick(null,l[`f_rest_${r+1}`]/4)),I.assign(t.pick(null,2),h.pick(null,l[`f_rest_${r+2}`]/4)),b.push(t)}return new Z(n,s,a,f,d,b,g,p,y,r)}static async fromPLYFile(t,r=3){let a=await Z.loadFile(t);return Z.fromArrayBuffer(a,r)}static decodeHeader(t){let r=new TextDecoder,a=0,e="",n=100;for(;;){if(a+n>=t.byteLength)throw new Error("End of file reached while searching for end of header");let s=new Uint8Array(t,a,n);e+=r.decode(s),a+=n;let i=a-2*n,o=new Uint8Array(t,Math.max(0,i),i>0?2*n:n);if(r.decode(o).includes("end_header"))break}let s,i=e.split("\n"),o=0,h={},u={},l=0;for(let p=0;p<i.length;p++){let t=i[p].trim();if(t.startsWith("element vertex")){let r=t.match(/\d+/);r&&(o=parseInt(r[0]))}else if(t.startsWith("property")){let r=t.match(/(\w+)\s+(\w+)\s+(\w+)/);if(r){let t=r[2],a=r[3];h[a]=l,u[a]={dtype:t,index:l},l++}}else if(t.startsWith("format")){let r=t.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);r&&(s={format:r[2],version:r[3]})}else if("end_header"===t)break}let c=e.indexOf("end_header")+10+1,f=new DataView(t,c);return{splatCount:o,vertexData:f,headerOffset:a,propertiesDesc:u,format:s}}},X=class{constructor(t,r,a,e,n,s,i,o){this.config=t,this.xyz=r,this.scaling=a,this.color=e,this.opacity=n,this.harmonics=i,this.quaternion=s,this.variableChunkSize=o}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(t,r){let a=V.fromArray(t.xyz,r.xyz,r.chunkSize),e=V.fromArray(t.scaling,r.scaling,r.chunkSize),n=V.fromArray(t.colors,r.color,r.chunkSize),s=V.fromArray(t.opacity,r.opacity,r.chunkSize),i=V.fromArray(t.rotation,r.quaternion,r.chunkSize),o=t.harmonics,h=[];if(r.harmonics)for(let u=0;u<o.length;u++){let t=V.fromArray(o[u],r.harmonics,r.chunkSize);h.push(t)}return new X(r,a,e,n,s,i,h)}_countIndexesInChunks(t){let r=[],a=this.nchunks,e=this.chunkSize,n=this.nsplats,s=V.getRequiredNChunks(n,e);if(a===s)for(let i=0;i<t.length;i++){let a=t[i],e=Math.floor(a/this.chunkSize);e in r?r[e].push(a):r[e]=[a]}else{let n=this.variableChunkSize,s={},i=0;for(let t=0;t<a;t++)s[t]=i,i+=n[t];for(let o=0;o<t.length;o++){let i=t[o],h=Math.min(Math.floor(i/e),a-1);for(;i>=s[h]+n[h];)h++;h in r?r[h].push(i):r[h]=[i]}}return r}pruneSplats(t){let r,a=this._countIndexesInChunks(t),e=[];return a.length>0&&(r=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),a.forEach(((t,a)=>{r[a]-=t.length,r[a]<=0&&e.push(a)})),r=r.filter((t=>t>0))),new X(this.config,this.xyz.pruneFeature(t,e,r),this.scaling.pruneFeature(t,e,r),this.color.pruneFeature(t,e,r),this.opacity.pruneFeature(t,e,r),this.quaternion.pruneFeature(t,e,r),this.harmonics?this.harmonics.map((r=>r.pruneFeature(t,e,this.variableChunkSize))):void 0,r)}static async loadConfig(t){return await(await fetch(t,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){let t={format:"binary_little_endian",version:"1.0"},r={},a=0;if(r.x={dtype:"float",index:a},a++,r.y={dtype:"float",index:a},a++,r.z={dtype:"float",index:a},a++,r.f_dc_0={dtype:"float",index:a},a++,r.f_dc_1={dtype:"float",index:a},a++,r.f_dc_2={dtype:"float",index:a},a++,this.harmonics&&this.harmonics.length>0)for(let n=0;n<this.harmonics.length;n++)r[`f_rest_${n}`]={dtype:"float",index:a},a++,r[`f_rest_${n+1}`]={dtype:"float",index:a},a++,r[`f_rest_${n+2}`]={dtype:"float",index:a},a++;r.opacity={dtype:"float",index:a},a++,r.scale_0={dtype:"float",index:a},a++,r.scale_1={dtype:"float",index:a},a++,r.scale_2={dtype:"float",index:a},a++,r.rot_0={dtype:"float",index:a},a++,r.rot_1={dtype:"float",index:a},a++,r.rot_2={dtype:"float",index:a},a++,r.rot_3={dtype:"float",index:a},a++;let e=this.harmonics?.map((t=>t.denormDequant()));return new Z(r,t,this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),e||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},J=p(m(),1),K=p(w(),1),tt=1e-6,rt=typeof Float32Array<"u"?Float32Array:Array,at=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});var et={};function nt(){var t=new rt(9);return rt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function st(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[4],t[4]=r[5],t[5]=r[6],t[6]=r[8],t[7]=r[9],t[8]=r[10],t}function it(t){var r=new rt(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function ot(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function ht(t,r,a,e,n,s,i,o,h){var u=new rt(9);return u[0]=t,u[1]=r,u[2]=a,u[3]=e,u[4]=n,u[5]=s,u[6]=i,u[7]=o,u[8]=h,u}function ut(t,r,a,e,n,s,i,o,h,u){return t[0]=r,t[1]=a,t[2]=e,t[3]=n,t[4]=s,t[5]=i,t[6]=o,t[7]=h,t[8]=u,t}function lt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ct(t,r){if(t===r){var a=r[1],e=r[2],n=r[5];t[1]=r[3],t[2]=r[6],t[3]=a,t[5]=r[7],t[6]=e,t[7]=n}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t}function ft(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=r[4],o=r[5],h=r[6],u=r[7],l=r[8],c=l*i-o*u,f=-l*s+o*h,p=u*s-i*h,d=a*c+e*f+n*p;return d?(d=1/d,t[0]=c*d,t[1]=(-l*e+n*u)*d,t[2]=(o*e-n*i)*d,t[3]=f*d,t[4]=(l*a-n*h)*d,t[5]=(-o*a+n*s)*d,t[6]=p*d,t[7]=(-u*a+e*h)*d,t[8]=(i*a-e*s)*d,t):null}function pt(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=r[4],o=r[5],h=r[6],u=r[7],l=r[8];return t[0]=i*l-o*u,t[1]=n*u-e*l,t[2]=e*o-n*i,t[3]=o*h-s*l,t[4]=a*l-n*h,t[5]=n*s-a*o,t[6]=s*u-i*h,t[7]=e*h-a*u,t[8]=a*i-e*s,t}function dt(t){var r=t[0],a=t[1],e=t[2],n=t[3],s=t[4],i=t[5],o=t[6],h=t[7],u=t[8];return r*(u*s-i*h)+a*(-u*n+i*o)+e*(h*n-s*o)}function yt(t,r,a){var e=r[0],n=r[1],s=r[2],i=r[3],o=r[4],h=r[5],u=r[6],l=r[7],c=r[8],f=a[0],p=a[1],d=a[2],y=a[3],g=a[4],m=a[5],b=a[6],_=a[7],v=a[8];return t[0]=f*e+p*i+d*u,t[1]=f*n+p*o+d*l,t[2]=f*s+p*h+d*c,t[3]=y*e+g*i+m*u,t[4]=y*n+g*o+m*l,t[5]=y*s+g*h+m*c,t[6]=b*e+_*i+v*u,t[7]=b*n+_*o+v*l,t[8]=b*s+_*h+v*c,t}function gt(t,r,a){var e=r[0],n=r[1],s=r[2],i=r[3],o=r[4],h=r[5],u=r[6],l=r[7],c=r[8],f=a[0],p=a[1];return t[0]=e,t[1]=n,t[2]=s,t[3]=i,t[4]=o,t[5]=h,t[6]=f*e+p*i+u,t[7]=f*n+p*o+l,t[8]=f*s+p*h+c,t}function mt(t,r,a){var e=r[0],n=r[1],s=r[2],i=r[3],o=r[4],h=r[5],u=r[6],l=r[7],c=r[8],f=Math.sin(a),p=Math.cos(a);return t[0]=p*e+f*i,t[1]=p*n+f*o,t[2]=p*s+f*h,t[3]=p*i-f*e,t[4]=p*o-f*n,t[5]=p*h-f*s,t[6]=u,t[7]=l,t[8]=c,t}function bt(t,r,a){var e=a[0],n=a[1];return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=n*r[3],t[4]=n*r[4],t[5]=n*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function _t(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=r[0],t[7]=r[1],t[8]=1,t}function vt(t,r){var a=Math.sin(r),e=Math.cos(r);return t[0]=e,t[1]=a,t[2]=0,t[3]=-a,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mt(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=r[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wt(t,r){return t[0]=r[0],t[1]=r[1],t[2]=0,t[3]=r[2],t[4]=r[3],t[5]=0,t[6]=r[4],t[7]=r[5],t[8]=1,t}function xt(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=a+a,o=e+e,h=n+n,u=a*i,l=e*i,c=e*o,f=n*i,p=n*o,d=n*h,y=s*i,g=s*o,m=s*h;return t[0]=1-c-d,t[3]=l-m,t[6]=f+g,t[1]=l+m,t[4]=1-u-d,t[7]=p-y,t[2]=f-g,t[5]=p+y,t[8]=1-u-c,t}function kt(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=r[4],o=r[5],h=r[6],u=r[7],l=r[8],c=r[9],f=r[10],p=r[11],d=r[12],y=r[13],g=r[14],m=r[15],b=a*o-e*i,_=a*h-n*i,v=a*u-s*i,M=e*h-n*o,w=e*u-s*o,x=n*u-s*h,k=l*y-c*d,A=l*g-f*d,q=l*m-p*d,z=c*g-f*y,j=c*m-p*y,V=f*m-p*g,S=b*V-_*j+v*z+M*q-w*A+x*k;return S?(S=1/S,t[0]=(o*V-h*j+u*z)*S,t[1]=(h*q-i*V-u*A)*S,t[2]=(i*j-o*q+u*k)*S,t[3]=(n*j-e*V-s*z)*S,t[4]=(a*V-n*q+s*A)*S,t[5]=(e*q-a*j-s*k)*S,t[6]=(y*x-g*w+m*M)*S,t[7]=(g*v-d*x-m*_)*S,t[8]=(d*w-y*v+m*b)*S,t):null}function At(t,r,a){return t[0]=2/r,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/a,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function qt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function zt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function jt(t,r,a){return t[0]=r[0]+a[0],t[1]=r[1]+a[1],t[2]=r[2]+a[2],t[3]=r[3]+a[3],t[4]=r[4]+a[4],t[5]=r[5]+a[5],t[6]=r[6]+a[6],t[7]=r[7]+a[7],t[8]=r[8]+a[8],t}function Vt(t,r,a){return t[0]=r[0]-a[0],t[1]=r[1]-a[1],t[2]=r[2]-a[2],t[3]=r[3]-a[3],t[4]=r[4]-a[4],t[5]=r[5]-a[5],t[6]=r[6]-a[6],t[7]=r[7]-a[7],t[8]=r[8]-a[8],t}function St(t,r,a){return t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t[3]=r[3]*a,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=r[7]*a,t[8]=r[8]*a,t}function It(t,r,a,e){return t[0]=r[0]+a[0]*e,t[1]=r[1]+a[1]*e,t[2]=r[2]+a[2]*e,t[3]=r[3]+a[3]*e,t[4]=r[4]+a[4]*e,t[5]=r[5]+a[5]*e,t[6]=r[6]+a[6]*e,t[7]=r[7]+a[7]*e,t[8]=r[8]+a[8]*e,t}function Dt(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]}function Ft(t,r){var a=t[0],e=t[1],n=t[2],s=t[3],i=t[4],o=t[5],h=t[6],u=t[7],l=t[8],c=r[0],f=r[1],p=r[2],d=r[3],y=r[4],g=r[5],m=r[6],b=r[7],_=r[8];return Math.abs(a-c)<=tt*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(e-f)<=tt*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(n-p)<=tt*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-d)<=tt*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(i-y)<=tt*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-g)<=tt*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(h-m)<=tt*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-b)<=tt*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(l-_)<=tt*Math.max(1,Math.abs(l),Math.abs(_))}c(et,{add:()=>jt,adjoint:()=>pt,clone:()=>it,copy:()=>ot,create:()=>nt,determinant:()=>dt,equals:()=>Ft,exactEquals:()=>Dt,frob:()=>zt,fromMat2d:()=>wt,fromMat4:()=>st,fromQuat:()=>xt,fromRotation:()=>vt,fromScaling:()=>Mt,fromTranslation:()=>_t,fromValues:()=>ht,identity:()=>lt,invert:()=>ft,mul:()=>Bt,multiply:()=>yt,multiplyScalar:()=>St,multiplyScalarAndAdd:()=>It,normalFromMat4:()=>kt,projection:()=>At,rotate:()=>mt,scale:()=>bt,set:()=>ut,str:()=>qt,sub:()=>Nt,subtract:()=>Vt,translate:()=>gt,transpose:()=>ct});var Bt=yt,Nt=Vt,Ut={};function Ct(){var t=new rt(16);return rt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Lt(t){var r=new rt(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Et(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function Ot(t,r,a,e,n,s,i,o,h,u,l,c,f,p,d,y){var g=new rt(16);return g[0]=t,g[1]=r,g[2]=a,g[3]=e,g[4]=n,g[5]=s,g[6]=i,g[7]=o,g[8]=h,g[9]=u,g[10]=l,g[11]=c,g[12]=f,g[13]=p,g[14]=d,g[15]=y,g}function $t(t,r,a,e,n,s,i,o,h,u,l,c,f,p,d,y,g){return t[0]=r,t[1]=a,t[2]=e,t[3]=n,t[4]=s,t[5]=i,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=f,t[12]=p,t[13]=d,t[14]=y,t[15]=g,t}function Pt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tt(t,r){if(t===r){var a=r[1],e=r[2],n=r[3],s=r[6],i=r[7],o=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=a,t[6]=r[9],t[7]=r[13],t[8]=e,t[9]=s,t[11]=r[14],t[12]=n,t[13]=i,t[14]=o}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function Rt(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=r[4],o=r[5],h=r[6],u=r[7],l=r[8],c=r[9],f=r[10],p=r[11],d=r[12],y=r[13],g=r[14],m=r[15],b=a*o-e*i,_=a*h-n*i,v=a*u-s*i,M=e*h-n*o,w=e*u-s*o,x=n*u-s*h,k=l*y-c*d,A=l*g-f*d,q=l*m-p*d,z=c*g-f*y,j=c*m-p*y,V=f*m-p*g,S=b*V-_*j+v*z+M*q-w*A+x*k;return S?(S=1/S,t[0]=(o*V-h*j+u*z)*S,t[1]=(n*j-e*V-s*z)*S,t[2]=(y*x-g*w+m*M)*S,t[3]=(f*w-c*x-p*M)*S,t[4]=(h*q-i*V-u*A)*S,t[5]=(a*V-n*q+s*A)*S,t[6]=(g*v-d*x-m*_)*S,t[7]=(l*x-f*v+p*_)*S,t[8]=(i*j-o*q+u*k)*S,t[9]=(e*q-a*j-s*k)*S,t[10]=(d*w-y*v+m*b)*S,t[11]=(c*v-l*w-p*b)*S,t[12]=(o*A-i*z-h*k)*S,t[13]=(a*z-e*A+n*k)*S,t[14]=(y*_-d*M-g*b)*S,t[15]=(l*M-c*_+f*b)*S,t):null}function Gt(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=r[4],o=r[5],h=r[6],u=r[7],l=r[8],c=r[9],f=r[10],p=r[11],d=r[12],y=r[13],g=r[14],m=r[15];return t[0]=o*(f*m-p*g)-c*(h*m-u*g)+y*(h*p-u*f),t[1]=-(e*(f*m-p*g)-c*(n*m-s*g)+y*(n*p-s*f)),t[2]=e*(h*m-u*g)-o*(n*m-s*g)+y*(n*u-s*h),t[3]=-(e*(h*p-u*f)-o*(n*p-s*f)+c*(n*u-s*h)),t[4]=-(i*(f*m-p*g)-l*(h*m-u*g)+d*(h*p-u*f)),t[5]=a*(f*m-p*g)-l*(n*m-s*g)+d*(n*p-s*f),t[6]=-(a*(h*m-u*g)-i*(n*m-s*g)+d*(n*u-s*h)),t[7]=a*(h*p-u*f)-i*(n*p-s*f)+l*(n*u-s*h),t[8]=i*(c*m-p*y)-l*(o*m-u*y)+d*(o*p-u*c),t[9]=-(a*(c*m-p*y)-l*(e*m-s*y)+d*(e*p-s*c)),t[10]=a*(o*m-u*y)-i*(e*m-s*y)+d*(e*u-s*o),t[11]=-(a*(o*p-u*c)-i*(e*p-s*c)+l*(e*u-s*o)),t[12]=-(i*(c*g-f*y)-l*(o*g-h*y)+d*(o*f-h*c)),t[13]=a*(c*g-f*y)-l*(e*g-n*y)+d*(e*f-n*c),t[14]=-(a*(o*g-h*y)-i*(e*g-n*y)+d*(e*h-n*o)),t[15]=a*(o*f-h*c)-i*(e*f-n*c)+l*(e*h-n*o),t}function Ht(t){var r=t[0],a=t[1],e=t[2],n=t[3],s=t[4],i=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],f=t[11],p=t[12],d=t[13],y=t[14],g=t[15],m=r*i-a*s,b=r*o-e*s,_=r*h-n*s,v=a*o-e*i,M=a*h-n*i,w=e*h-n*o,x=u*d-l*p,k=u*y-c*p,A=u*g-f*p,q=l*y-c*d,z=l*g-f*d,j=c*g-f*y;return m*j-b*z+_*q+v*A-M*k+w*x}function Wt(t,r,a){var e=r[0],n=r[1],s=r[2],i=r[3],o=r[4],h=r[5],u=r[6],l=r[7],c=r[8],f=r[9],p=r[10],d=r[11],y=r[12],g=r[13],m=r[14],b=r[15],_=a[0],v=a[1],M=a[2],w=a[3];return t[0]=_*e+v*o+M*c+w*y,t[1]=_*n+v*h+M*f+w*g,t[2]=_*s+v*u+M*p+w*m,t[3]=_*i+v*l+M*d+w*b,_=a[4],v=a[5],M=a[6],w=a[7],t[4]=_*e+v*o+M*c+w*y,t[5]=_*n+v*h+M*f+w*g,t[6]=_*s+v*u+M*p+w*m,t[7]=_*i+v*l+M*d+w*b,_=a[8],v=a[9],M=a[10],w=a[11],t[8]=_*e+v*o+M*c+w*y,t[9]=_*n+v*h+M*f+w*g,t[10]=_*s+v*u+M*p+w*m,t[11]=_*i+v*l+M*d+w*b,_=a[12],v=a[13],M=a[14],w=a[15],t[12]=_*e+v*o+M*c+w*y,t[13]=_*n+v*h+M*f+w*g,t[14]=_*s+v*u+M*p+w*m,t[15]=_*i+v*l+M*d+w*b,t}function Yt(t,r,a){var e,n,s,i,o,h,u,l,c,f,p,d,y=a[0],g=a[1],m=a[2];return r===t?(t[12]=r[0]*y+r[4]*g+r[8]*m+r[12],t[13]=r[1]*y+r[5]*g+r[9]*m+r[13],t[14]=r[2]*y+r[6]*g+r[10]*m+r[14],t[15]=r[3]*y+r[7]*g+r[11]*m+r[15]):(e=r[0],n=r[1],s=r[2],i=r[3],o=r[4],h=r[5],u=r[6],l=r[7],c=r[8],f=r[9],p=r[10],d=r[11],t[0]=e,t[1]=n,t[2]=s,t[3]=i,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=f,t[10]=p,t[11]=d,t[12]=e*y+o*g+c*m+r[12],t[13]=n*y+h*g+f*m+r[13],t[14]=s*y+u*g+p*m+r[14],t[15]=i*y+l*g+d*m+r[15]),t}function Qt(t,r,a){var e=a[0],n=a[1],s=a[2];return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=r[7]*n,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=r[11]*s,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function Zt(t,r,a,e){var n,s,i,o,h,u,l,c,f,p,d,y,g,m,b,_,v,M,w,x,k,A,q,z,j=e[0],V=e[1],S=e[2],I=Math.hypot(j,V,S);return I<tt?null:(I=1/I,j*=I,V*=I,S*=I,n=Math.sin(a),s=Math.cos(a),i=1-s,o=r[0],h=r[1],u=r[2],l=r[3],c=r[4],f=r[5],p=r[6],d=r[7],y=r[8],g=r[9],m=r[10],b=r[11],_=j*j*i+s,v=V*j*i+S*n,M=S*j*i-V*n,w=j*V*i-S*n,x=V*V*i+s,k=S*V*i+j*n,A=j*S*i+V*n,q=V*S*i-j*n,z=S*S*i+s,t[0]=o*_+c*v+y*M,t[1]=h*_+f*v+g*M,t[2]=u*_+p*v+m*M,t[3]=l*_+d*v+b*M,t[4]=o*w+c*x+y*k,t[5]=h*w+f*x+g*k,t[6]=u*w+p*x+m*k,t[7]=l*w+d*x+b*k,t[8]=o*A+c*q+y*z,t[9]=h*A+f*q+g*z,t[10]=u*A+p*q+m*z,t[11]=l*A+d*q+b*z,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function Xt(t,r,a){var e=Math.sin(a),n=Math.cos(a),s=r[4],i=r[5],o=r[6],h=r[7],u=r[8],l=r[9],c=r[10],f=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=s*n+u*e,t[5]=i*n+l*e,t[6]=o*n+c*e,t[7]=h*n+f*e,t[8]=u*n-s*e,t[9]=l*n-i*e,t[10]=c*n-o*e,t[11]=f*n-h*e,t}function Jt(t,r,a){var e=Math.sin(a),n=Math.cos(a),s=r[0],i=r[1],o=r[2],h=r[3],u=r[8],l=r[9],c=r[10],f=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=s*n-u*e,t[1]=i*n-l*e,t[2]=o*n-c*e,t[3]=h*n-f*e,t[8]=s*e+u*n,t[9]=i*e+l*n,t[10]=o*e+c*n,t[11]=h*e+f*n,t}function Kt(t,r,a){var e=Math.sin(a),n=Math.cos(a),s=r[0],i=r[1],o=r[2],h=r[3],u=r[4],l=r[5],c=r[6],f=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=s*n+u*e,t[1]=i*n+l*e,t[2]=o*n+c*e,t[3]=h*n+f*e,t[4]=u*n-s*e,t[5]=l*n-i*e,t[6]=c*n-o*e,t[7]=f*n-h*e,t}function tr(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function rr(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=r[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ar(t,r,a){var e,n,s,i=a[0],o=a[1],h=a[2],u=Math.hypot(i,o,h);return u<tt?null:(u=1/u,i*=u,o*=u,h*=u,e=Math.sin(r),n=Math.cos(r),s=1-n,t[0]=i*i*s+n,t[1]=o*i*s+h*e,t[2]=h*i*s-o*e,t[3]=0,t[4]=i*o*s-h*e,t[5]=o*o*s+n,t[6]=h*o*s+i*e,t[7]=0,t[8]=i*h*s+o*e,t[9]=o*h*s-i*e,t[10]=h*h*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function er(t,r){var a=Math.sin(r),e=Math.cos(r);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nr(t,r){var a=Math.sin(r),e=Math.cos(r);return t[0]=e,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sr(t,r){var a=Math.sin(r),e=Math.cos(r);return t[0]=e,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ir(t,r,a){var e=r[0],n=r[1],s=r[2],i=r[3],o=e+e,h=n+n,u=s+s,l=e*o,c=e*h,f=e*u,p=n*h,d=n*u,y=s*u,g=i*o,m=i*h,b=i*u;return t[0]=1-(p+y),t[1]=c+b,t[2]=f-m,t[3]=0,t[4]=c-b,t[5]=1-(l+y),t[6]=d+g,t[7]=0,t[8]=f+m,t[9]=d-g,t[10]=1-(l+p),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function or(t,r){var a=new rt(3),e=-r[0],n=-r[1],s=-r[2],i=r[3],o=r[4],h=r[5],u=r[6],l=r[7],c=e*e+n*n+s*s+i*i;return c>0?(a[0]=2*(o*i+l*e+h*s-u*n)/c,a[1]=2*(h*i+l*n+u*e-o*s)/c,a[2]=2*(u*i+l*s+o*n-h*e)/c):(a[0]=2*(o*i+l*e+h*s-u*n),a[1]=2*(h*i+l*n+u*e-o*s),a[2]=2*(u*i+l*s+o*n-h*e)),ir(t,r,a),t}function hr(t,r){return t[0]=r[12],t[1]=r[13],t[2]=r[14],t}function ur(t,r){var a=r[0],e=r[1],n=r[2],s=r[4],i=r[5],o=r[6],h=r[8],u=r[9],l=r[10];return t[0]=Math.hypot(a,e,n),t[1]=Math.hypot(s,i,o),t[2]=Math.hypot(h,u,l),t}function lr(t,r){var a=new rt(3);ur(a,r);var e=1/a[0],n=1/a[1],s=1/a[2],i=r[0]*e,o=r[1]*n,h=r[2]*s,u=r[4]*e,l=r[5]*n,c=r[6]*s,f=r[8]*e,p=r[9]*n,d=r[10]*s,y=i+l+d,g=0;return y>0?(g=2*Math.sqrt(y+1),t[3]=.25*g,t[0]=(c-p)/g,t[1]=(f-h)/g,t[2]=(o-u)/g):i>l&&i>d?(g=2*Math.sqrt(1+i-l-d),t[3]=(c-p)/g,t[0]=.25*g,t[1]=(o+u)/g,t[2]=(f+h)/g):l>d?(g=2*Math.sqrt(1+l-i-d),t[3]=(f-h)/g,t[0]=(o+u)/g,t[1]=.25*g,t[2]=(c+p)/g):(g=2*Math.sqrt(1+d-i-l),t[3]=(o-u)/g,t[0]=(f+h)/g,t[1]=(c+p)/g,t[2]=.25*g),t}function cr(t,r,a,e){var n=r[0],s=r[1],i=r[2],o=r[3],h=n+n,u=s+s,l=i+i,c=n*h,f=n*u,p=n*l,d=s*u,y=s*l,g=i*l,m=o*h,b=o*u,_=o*l,v=e[0],M=e[1],w=e[2];return t[0]=(1-(d+g))*v,t[1]=(f+_)*v,t[2]=(p-b)*v,t[3]=0,t[4]=(f-_)*M,t[5]=(1-(c+g))*M,t[6]=(y+m)*M,t[7]=0,t[8]=(p+b)*w,t[9]=(y-m)*w,t[10]=(1-(c+d))*w,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function fr(t,r,a,e,n){var s=r[0],i=r[1],o=r[2],h=r[3],u=s+s,l=i+i,c=o+o,f=s*u,p=s*l,d=s*c,y=i*l,g=i*c,m=o*c,b=h*u,_=h*l,v=h*c,M=e[0],w=e[1],x=e[2],k=n[0],A=n[1],q=n[2],z=(1-(y+m))*M,j=(p+v)*M,V=(d-_)*M,S=(p-v)*w,I=(1-(f+m))*w,D=(g+b)*w,F=(d+_)*x,B=(g-b)*x,N=(1-(f+y))*x;return t[0]=z,t[1]=j,t[2]=V,t[3]=0,t[4]=S,t[5]=I,t[6]=D,t[7]=0,t[8]=F,t[9]=B,t[10]=N,t[11]=0,t[12]=a[0]+k-(z*k+S*A+F*q),t[13]=a[1]+A-(j*k+I*A+B*q),t[14]=a[2]+q-(V*k+D*A+N*q),t[15]=1,t}function pr(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=a+a,o=e+e,h=n+n,u=a*i,l=e*i,c=e*o,f=n*i,p=n*o,d=n*h,y=s*i,g=s*o,m=s*h;return t[0]=1-c-d,t[1]=l+m,t[2]=f-g,t[3]=0,t[4]=l-m,t[5]=1-u-d,t[6]=p+y,t[7]=0,t[8]=f+g,t[9]=p-y,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dr(t,r,a,e,n,s,i){var o=1/(a-r),h=1/(n-e),u=1/(s-i);return t[0]=2*s*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*h,t[6]=0,t[7]=0,t[8]=(a+r)*o,t[9]=(n+e)*h,t[10]=(i+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*s*2*u,t[15]=0,t}function yr(t,r,a,e,n){var s,i=1/Math.tan(r/2);return t[0]=i/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(e-n),t[10]=(n+e)*s,t[14]=2*n*e*s):(t[10]=-1,t[14]=-2*e),t}c(Ut,{add:()=>qr,adjoint:()=>Gt,clone:()=>Lt,copy:()=>Et,create:()=>Ct,determinant:()=>Ht,equals:()=>Ir,exactEquals:()=>Sr,frob:()=>Ar,fromQuat:()=>pr,fromQuat2:()=>or,fromRotation:()=>ar,fromRotationTranslation:()=>ir,fromRotationTranslationScale:()=>cr,fromRotationTranslationScaleOrigin:()=>fr,fromScaling:()=>rr,fromTranslation:()=>tr,fromValues:()=>Ot,fromXRotation:()=>er,fromYRotation:()=>nr,fromZRotation:()=>sr,frustum:()=>dr,getRotation:()=>lr,getScaling:()=>ur,getTranslation:()=>hr,identity:()=>Pt,invert:()=>Rt,lookAt:()=>wr,mul:()=>Dr,multiply:()=>Wt,multiplyScalar:()=>jr,multiplyScalarAndAdd:()=>Vr,ortho:()=>vr,orthoNO:()=>_r,orthoZO:()=>Mr,perspective:()=>gr,perspectiveFromFieldOfView:()=>br,perspectiveNO:()=>yr,perspectiveZO:()=>mr,rotate:()=>Zt,rotateX:()=>Xt,rotateY:()=>Jt,rotateZ:()=>Kt,scale:()=>Qt,set:()=>$t,str:()=>kr,sub:()=>Fr,subtract:()=>zr,targetTo:()=>xr,translate:()=>Yt,transpose:()=>Tt});var gr=yr;function mr(t,r,a,e,n){var s,i=1/Math.tan(r/2);return t[0]=i/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(e-n),t[10]=n*s,t[14]=n*e*s):(t[10]=-1,t[14]=-e),t}function br(t,r,a,e){var n=Math.tan(r.upDegrees*Math.PI/180),s=Math.tan(r.downDegrees*Math.PI/180),i=Math.tan(r.leftDegrees*Math.PI/180),o=Math.tan(r.rightDegrees*Math.PI/180),h=2/(i+o),u=2/(n+s);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(i-o)*h*.5,t[9]=(n-s)*u*.5,t[10]=e/(a-e),t[11]=-1,t[12]=0,t[13]=0,t[14]=e*a/(a-e),t[15]=0,t}function _r(t,r,a,e,n,s,i){var o=1/(r-a),h=1/(e-n),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(r+a)*o,t[13]=(n+e)*h,t[14]=(i+s)*u,t[15]=1,t}var vr=_r;function Mr(t,r,a,e,n,s,i){var o=1/(r-a),h=1/(e-n),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(r+a)*o,t[13]=(n+e)*h,t[14]=s*u,t[15]=1,t}function wr(t,r,a,e){var n,s,i,o,h,u,l,c,f,p,d=r[0],y=r[1],g=r[2],m=e[0],b=e[1],_=e[2],v=a[0],M=a[1],w=a[2];return Math.abs(d-v)<tt&&Math.abs(y-M)<tt&&Math.abs(g-w)<tt?Pt(t):(l=d-v,c=y-M,f=g-w,p=1/Math.hypot(l,c,f),l*=p,c*=p,f*=p,n=b*f-_*c,s=_*l-m*f,i=m*c-b*l,p=Math.hypot(n,s,i),p?(p=1/p,n*=p,s*=p,i*=p):(n=0,s=0,i=0),o=c*i-f*s,h=f*n-l*i,u=l*s-c*n,p=Math.hypot(o,h,u),p?(p=1/p,o*=p,h*=p,u*=p):(o=0,h=0,u=0),t[0]=n,t[1]=o,t[2]=l,t[3]=0,t[4]=s,t[5]=h,t[6]=c,t[7]=0,t[8]=i,t[9]=u,t[10]=f,t[11]=0,t[12]=-(n*d+s*y+i*g),t[13]=-(o*d+h*y+u*g),t[14]=-(l*d+c*y+f*g),t[15]=1,t)}function xr(t,r,a,e){var n=r[0],s=r[1],i=r[2],o=e[0],h=e[1],u=e[2],l=n-a[0],c=s-a[1],f=i-a[2],p=l*l+c*c+f*f;p>0&&(p=1/Math.sqrt(p),l*=p,c*=p,f*=p);var d=h*f-u*c,y=u*l-o*f,g=o*c-h*l;return p=d*d+y*y+g*g,p>0&&(p=1/Math.sqrt(p),d*=p,y*=p,g*=p),t[0]=d,t[1]=y,t[2]=g,t[3]=0,t[4]=c*g-f*y,t[5]=f*d-l*g,t[6]=l*y-c*d,t[7]=0,t[8]=l,t[9]=c,t[10]=f,t[11]=0,t[12]=n,t[13]=s,t[14]=i,t[15]=1,t}function kr(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ar(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function qr(t,r,a){return t[0]=r[0]+a[0],t[1]=r[1]+a[1],t[2]=r[2]+a[2],t[3]=r[3]+a[3],t[4]=r[4]+a[4],t[5]=r[5]+a[5],t[6]=r[6]+a[6],t[7]=r[7]+a[7],t[8]=r[8]+a[8],t[9]=r[9]+a[9],t[10]=r[10]+a[10],t[11]=r[11]+a[11],t[12]=r[12]+a[12],t[13]=r[13]+a[13],t[14]=r[14]+a[14],t[15]=r[15]+a[15],t}function zr(t,r,a){return t[0]=r[0]-a[0],t[1]=r[1]-a[1],t[2]=r[2]-a[2],t[3]=r[3]-a[3],t[4]=r[4]-a[4],t[5]=r[5]-a[5],t[6]=r[6]-a[6],t[7]=r[7]-a[7],t[8]=r[8]-a[8],t[9]=r[9]-a[9],t[10]=r[10]-a[10],t[11]=r[11]-a[11],t[12]=r[12]-a[12],t[13]=r[13]-a[13],t[14]=r[14]-a[14],t[15]=r[15]-a[15],t}function jr(t,r,a){return t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t[3]=r[3]*a,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=r[7]*a,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12]*a,t[13]=r[13]*a,t[14]=r[14]*a,t[15]=r[15]*a,t}function Vr(t,r,a,e){return t[0]=r[0]+a[0]*e,t[1]=r[1]+a[1]*e,t[2]=r[2]+a[2]*e,t[3]=r[3]+a[3]*e,t[4]=r[4]+a[4]*e,t[5]=r[5]+a[5]*e,t[6]=r[6]+a[6]*e,t[7]=r[7]+a[7]*e,t[8]=r[8]+a[8]*e,t[9]=r[9]+a[9]*e,t[10]=r[10]+a[10]*e,t[11]=r[11]+a[11]*e,t[12]=r[12]+a[12]*e,t[13]=r[13]+a[13]*e,t[14]=r[14]+a[14]*e,t[15]=r[15]+a[15]*e,t}function Sr(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]}function Ir(t,r){var a=t[0],e=t[1],n=t[2],s=t[3],i=t[4],o=t[5],h=t[6],u=t[7],l=t[8],c=t[9],f=t[10],p=t[11],d=t[12],y=t[13],g=t[14],m=t[15],b=r[0],_=r[1],v=r[2],M=r[3],w=r[4],x=r[5],k=r[6],A=r[7],q=r[8],z=r[9],j=r[10],V=r[11],S=r[12],I=r[13],D=r[14],F=r[15];return Math.abs(a-b)<=tt*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(e-_)<=tt*Math.max(1,Math.abs(e),Math.abs(_))&&Math.abs(n-v)<=tt*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-M)<=tt*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(i-w)<=tt*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-x)<=tt*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(h-k)<=tt*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(u-A)<=tt*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-q)<=tt*Math.max(1,Math.abs(l),Math.abs(q))&&Math.abs(c-z)<=tt*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(f-j)<=tt*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(p-V)<=tt*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(d-S)<=tt*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(y-I)<=tt*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(g-D)<=tt*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(m-F)<=tt*Math.max(1,Math.abs(m),Math.abs(F))}var Dr=Wt,Fr=zr,Br={};function Nr(){var t=new rt(3);return rt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ur(t){var r=t[0],a=t[1],e=t[2];return Math.hypot(r,a,e)}function Cr(t,r,a){var e=new rt(3);return e[0]=t,e[1]=r,e[2]=a,e}function Lr(t,r){var a=r[0],e=r[1],n=r[2],s=a*a+e*e+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s,t}function Er(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function Or(t,r,a){var e=r[0],n=r[1],s=r[2],i=a[0],o=a[1],h=a[2];return t[0]=n*h-s*o,t[1]=s*i-e*h,t[2]=e*o-n*i,t}c(Br,{add:()=>qa,calculateW:()=>ca,clone:()=>wa,conjugate:()=>ba,copy:()=>ka,create:()=>aa,dot:()=>Va,equals:()=>Ca,exactEquals:()=>Ua,exp:()=>fa,fromEuler:()=>va,fromMat3:()=>_a,fromValues:()=>xa,getAngle:()=>ia,getAxisAngle:()=>sa,identity:()=>ea,invert:()=>ma,len:()=>Da,length:()=>Ia,lerp:()=>Sa,ln:()=>pa,mul:()=>za,multiply:()=>oa,normalize:()=>Na,pow:()=>da,random:()=>ga,rotateX:()=>ha,rotateY:()=>ua,rotateZ:()=>la,rotationTo:()=>La,scale:()=>ja,set:()=>Aa,setAxes:()=>Oa,setAxisAngle:()=>na,slerp:()=>ya,sqlerp:()=>Ea,sqrLen:()=>Ba,squaredLength:()=>Fa,str:()=>Ma});var $r=Ur;(function(){var t=Nr()})();function Pr(){var t=new rt(4);return rt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Tr(t){var r=new rt(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Rr(t,r,a,e){var n=new rt(4);return n[0]=t,n[1]=r,n[2]=a,n[3]=e,n}function Gr(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function Hr(t,r,a,e,n){return t[0]=r,t[1]=a,t[2]=e,t[3]=n,t}function Wr(t,r,a){return t[0]=r[0]+a[0],t[1]=r[1]+a[1],t[2]=r[2]+a[2],t[3]=r[3]+a[3],t}function Yr(t,r,a){return t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t[3]=r[3]*a,t}function Qr(t){var r=t[0],a=t[1],e=t[2],n=t[3];return Math.hypot(r,a,e,n)}function Zr(t){var r=t[0],a=t[1],e=t[2],n=t[3];return r*r+a*a+e*e+n*n}function Xr(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=a*a+e*e+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=a*i,t[1]=e*i,t[2]=n*i,t[3]=s*i,t}function Jr(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]}function Kr(t,r,a,e){var n=r[0],s=r[1],i=r[2],o=r[3];return t[0]=n+e*(a[0]-n),t[1]=s+e*(a[1]-s),t[2]=i+e*(a[2]-i),t[3]=o+e*(a[3]-o),t}function ta(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]}function ra(t,r){var a=t[0],e=t[1],n=t[2],s=t[3],i=r[0],o=r[1],h=r[2],u=r[3];return Math.abs(a-i)<=tt*Math.max(1,Math.abs(a),Math.abs(i))&&Math.abs(e-o)<=tt*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-h)<=tt*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-u)<=tt*Math.max(1,Math.abs(s),Math.abs(u))}(function(){var t=Pr()})();function aa(){var t=new rt(4);return rt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ea(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function na(t,r,a){a*=.5;var e=Math.sin(a);return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=Math.cos(a),t}function sa(t,r){var a=2*Math.acos(r[3]),e=Math.sin(a/2);return e>tt?(t[0]=r[0]/e,t[1]=r[1]/e,t[2]=r[2]/e):(t[0]=1,t[1]=0,t[2]=0),a}function ia(t,r){var a=Va(t,r);return Math.acos(2*a*a-1)}function oa(t,r,a){var e=r[0],n=r[1],s=r[2],i=r[3],o=a[0],h=a[1],u=a[2],l=a[3];return t[0]=e*l+i*o+n*u-s*h,t[1]=n*l+i*h+s*o-e*u,t[2]=s*l+i*u+e*h-n*o,t[3]=i*l-e*o-n*h-s*u,t}function ha(t,r,a){a*=.5;var e=r[0],n=r[1],s=r[2],i=r[3],o=Math.sin(a),h=Math.cos(a);return t[0]=e*h+i*o,t[1]=n*h+s*o,t[2]=s*h-n*o,t[3]=i*h-e*o,t}function ua(t,r,a){a*=.5;var e=r[0],n=r[1],s=r[2],i=r[3],o=Math.sin(a),h=Math.cos(a);return t[0]=e*h-s*o,t[1]=n*h+i*o,t[2]=s*h+e*o,t[3]=i*h-n*o,t}function la(t,r,a){a*=.5;var e=r[0],n=r[1],s=r[2],i=r[3],o=Math.sin(a),h=Math.cos(a);return t[0]=e*h+n*o,t[1]=n*h-e*o,t[2]=s*h+i*o,t[3]=i*h-s*o,t}function ca(t,r){var a=r[0],e=r[1],n=r[2];return t[0]=a,t[1]=e,t[2]=n,t[3]=Math.sqrt(Math.abs(1-a*a-e*e-n*n)),t}function fa(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=Math.sqrt(a*a+e*e+n*n),o=Math.exp(s),h=i>0?o*Math.sin(i)/i:0;return t[0]=a*h,t[1]=e*h,t[2]=n*h,t[3]=o*Math.cos(i),t}function pa(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=Math.sqrt(a*a+e*e+n*n),o=i>0?Math.atan2(i,s)/i:0;return t[0]=a*o,t[1]=e*o,t[2]=n*o,t[3]=.5*Math.log(a*a+e*e+n*n+s*s),t}function da(t,r,a){return pa(t,r),ja(t,t,a),fa(t,t),t}function ya(t,r,a,e){var n,s,i,o,h,u=r[0],l=r[1],c=r[2],f=r[3],p=a[0],d=a[1],y=a[2],g=a[3];return s=u*p+l*d+c*y+f*g,s<0&&(s=-s,p=-p,d=-d,y=-y,g=-g),1-s>tt?(n=Math.acos(s),i=Math.sin(n),o=Math.sin((1-e)*n)/i,h=Math.sin(e*n)/i):(o=1-e,h=e),t[0]=o*u+h*p,t[1]=o*l+h*d,t[2]=o*c+h*y,t[3]=o*f+h*g,t}function ga(t){var r=at(),a=at(),e=at(),n=Math.sqrt(1-r),s=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*a),t[1]=n*Math.cos(2*Math.PI*a),t[2]=s*Math.sin(2*Math.PI*e),t[3]=s*Math.cos(2*Math.PI*e),t}function ma(t,r){var a=r[0],e=r[1],n=r[2],s=r[3],i=a*a+e*e+n*n+s*s,o=i?1/i:0;return t[0]=-a*o,t[1]=-e*o,t[2]=-n*o,t[3]=s*o,t}function ba(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t}function _a(t,r){var a,e=r[0]+r[4]+r[8];if(e>0)a=Math.sqrt(e+1),t[3]=.5*a,a=.5/a,t[0]=(r[5]-r[7])*a,t[1]=(r[6]-r[2])*a,t[2]=(r[1]-r[3])*a;else{var n=0;r[4]>r[0]&&(n=1),r[8]>r[3*n+n]&&(n=2);var s=(n+1)%3,i=(n+2)%3;a=Math.sqrt(r[3*n+n]-r[3*s+s]-r[3*i+i]+1),t[n]=.5*a,a=.5/a,t[3]=(r[3*s+i]-r[3*i+s])*a,t[s]=(r[3*s+n]+r[3*n+s])*a,t[i]=(r[3*i+n]+r[3*n+i])*a}return t}function va(t,r,a,e){var n=.5*Math.PI/180;r*=n,a*=n,e*=n;var s=Math.sin(r),i=Math.cos(r),o=Math.sin(a),h=Math.cos(a),u=Math.sin(e),l=Math.cos(e);return t[0]=s*h*l-i*o*u,t[1]=i*o*l+s*h*u,t[2]=i*h*u-s*o*l,t[3]=i*h*l+s*o*u,t}function Ma(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var wa=Tr,xa=Rr,ka=Gr,Aa=Hr,qa=Wr,za=oa,ja=Yr,Va=Jr,Sa=Kr,Ia=Qr,Da=Ia,Fa=Zr,Ba=Fa,Na=Xr,Ua=ta,Ca=ra,La=function(){var t=Nr(),r=Cr(1,0,0),a=Cr(0,1,0);return function(e,n,s){var i=Er(n,s);return i<-.999999?(Or(t,r,n),$r(t)<1e-6&&Or(t,a,n),Lr(t,t),na(e,t,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Or(t,n,s),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+i,Na(e,e))}}(),Ea=function(){var t=aa(),r=aa();return function(a,e,n,s,i,o){return ya(t,e,i,o),ya(r,n,s,o),ya(a,t,r,2*o*(1-o)),a}}(),Oa=function(){var t=nt();return function(r,a,e,n){return t[0]=e[0],t[3]=e[1],t[6]=e[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-a[0],t[5]=-a[1],t[8]=-a[2],Na(r,_a(r,t))}}(),$a={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},Pa=class{constructor(t){this.version="",this._buffer=t}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let t=.28209479177387814,r=this.decoded.color.denormDequant(),a=this.decoded.opacity.denormDequant(),e=(0,J.default)(new Float32Array(4*r.shape[0]),[r.shape[0],4]);return K.mulseq(r,t),K.addseq(r,.5),K.mulseq(r,255),K.maxseq(r,0),K.minseq(r,255),""===this.version&&(K.negeq(a),K.expeq(a),K.addseq(a,1),K.recipeq(a),K.mulseq(a,255)),K.assign(e.hi(r.shape[0],3).lo(0,0),r),K.assign(e.hi(r.shape[0],4).lo(0,3),a),(0,J.default)(new Uint8Array(e.data),[r.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:t,chunkCount:r,chunkSize:a,typeChunks:e,vertexData:n,propertiesDesc:s,version:i}=this.decodeHeader();this.version=i;let o={xyz:s.xyz.compressionMethod,color:s.color.compressionMethod,opacity:s.opacity.compressionMethod,scaling:s.scaling.compressionMethod,quaternion:s.quaternion.compressionMethod,chunkSize:a};s.harmonics_0&&(o.harmonics=s.harmonics_0.compressionMethod);let h=n.byteOffset,u=Array(Object.keys(s).length);for(let m in s)u[s[m].index]={name:m,method:s[m].compressionMethod};let l,c=2*r*4,f=h,p="dynamic"===e?2*r:0,d=!1;if(p>0){let t=new Uint16Array(n.buffer.slice(f,f+p));f+=p,l=Array.from(t),d=!0}let y={};for(let m of u){let e,s=0,i=!0;if("norm8x"===m.method)s=1*t*$a[m.name];else if("norm11"===m.method)s=4*t;else{if("norm565"!==m.method)throw i=!1,new Error(`Not Implemented format: ${m.method}`);s=2*t}if(!i)throw new Error("loading chunk byt hasnot minmax!");{let t=n.buffer.slice(f,f+c);e=(0,J.default)(new Float32Array(t),[r,2]),f+=c}let o,h=n.buffer.slice(f,f+s);if(f+=s,"norm8x"===m.method)o=(0,J.default)(new Uint8Array(h),[t,$a[m.name]]);else if("norm11"===m.method)o=(0,J.default)(new Uint32Array(h));else{if("norm565"!==m.method)throw new Error(`Not Implemented format: ${m.method}`);o=(0,J.default)(new Uint16Array(h))}y[m.name]=new V(o,e,a,m.method,l,d)}let g=[];for(let m=0;m<15;m++){let t=y[`harmonics_${m}`];t&&(g.push(t),delete y[`harmonics_${m}`])}return g.length>0&&(y.harmonics=g),new X(o,y.xyz,y.scaling,y.color,y.opacity,y.quaternion,y.harmonics,l)}buildPreComputedBuffers(){let t=this.decoded,r=t.nsplats,a=new ArrayBuffer(24*r),e=new Float32Array(a),n=t.scaling.denormDequant(),s=t.quaternion.denormDequant(),i=Br.create(),o=et.create(),h=et.create(),u=et.create(),l=Ut.create();for(let c=0;c<r;c++){Ut.fromScaling(l,[Math.exp(n.get(c,0)),Math.exp(n.get(c,1)),Math.exp(n.get(c,2))]),et.fromMat4(h,l),Br.set(i,s.get(c,0),s.get(c,1),s.get(c,2),s.get(c,3)),et.fromQuat(o,i),et.multiply(u,o,h);let t=u;e[6*c]=t[0]*t[0]+t[3]*t[3]+t[6]*t[6],e[6*c+1]=t[0]*t[1]+t[3]*t[4]+t[6]*t[7],e[6*c+2]=t[0]*t[2]+t[3]*t[5]+t[6]*t[8],e[6*c+3]=t[1]*t[1]+t[4]*t[4]+t[7]*t[7],e[6*c+4]=t[1]*t[2]+t[4]*t[5]+t[7]*t[8],e[6*c+5]=t[2]*t[2]+t[5]*t[5]+t[8]*t[8]}this._precomputedCovarianceBufferData=a}decodeHeader(){let t=this._buffer,r=new TextDecoder,a=0,e="",n=100;for(;;){if(a+n>=t.byteLength)throw new Error("End of file reached while searching for end of header");let s=new Uint8Array(t,a,n);e+=r.decode(s),a+=n;let i=a-2*n,o=new Uint8Array(t,Math.max(0,i),i>=0?2*n:n);if(r.decode(o).includes("end_header"))break}let s=e.split("\n"),i=0,o=0,h=0,u=0,l="",c="",f={};for(let y=0;y<s.length;y++){let t=s[y].trim();if(t.startsWith("version"))c=t.split(" ")[1]??"";else if(t.startsWith("element vertex")){let r=t.match(/\d+/);r&&(i=parseInt(r[0]))}else if(t.startsWith("property")){let r=t.match(/(\w+)\s+(\w+)\s+(\w+)/);if(r){let t=r[2],a=r[3];f[t]={compressionMethod:a,index:u},u++}}else if(t.startsWith("element chunks")){let r=t.match(/\d+/);r&&(o=parseInt(r[0]))}else if(t.startsWith("element chunkSize")){let r=t.match(/\d+/);r&&(h=parseInt(r[0]))}else if(t.startsWith("element typeChunks")){let r=t.match(/(\w+)\s+(\w+)\s+(\w+)/);r&&(l=r[3])}else if("end_header"===t)break}let p=e.indexOf("end_header")+10+1,d=new DataView(t,p);return{splatCount:i,chunkCount:o,chunkSize:h,typeChunks:l,vertexData:d,propertiesDesc:f,version:c}}pruneSplats(t){let r=this.decodeBuffer().pruneSplats(t);return Pa.fromCompressedGaussianSplats(r,this.version)}static fromCompressedGaussianSplats(t,r){let a=t.xyz.length,e=t.xyz.nchunks,n=`gspline\nversion ${r}\nelement vertex ${a}\nelement chunks ${e}\nelement chunkSize ${t.chunkSize}\nelement typeChunks ${t.isDynamicChunks?"dynamic":"static"}\nproperty xyz ${t.xyz.method}\nproperty color ${t.color.method}\nproperty opacity ${t.opacity.method}\nproperty scaling ${t.scaling.method}\nproperty quaternion ${t.quaternion.method}`;if(t.harmonics&&t.harmonics.length>0)for(let k=0;k<t.harmonics.length;k++)n=`${n}\nproperty harmonics_${k} ${t.harmonics[k].method}`;n=`${n}\nend_header\n`;let s=(new TextEncoder).encode(n),i=2*e*4,o=t.xyz.quantized.data.buffer.byteLength,h=t.xyz instanceof V?i:0,u=t.color.quantized.data.buffer.byteLength,l=t.color instanceof V?i:0,c=t.opacity.quantized.data.buffer.byteLength,f=t.opacity instanceof V?i:0,p=t.scaling.quantized.data.buffer.byteLength,d=t.scaling instanceof V?i:0,y=t.quaternion.quantized.data.buffer.byteLength,g=t.quaternion instanceof V?i:0,m=t.variableChunkSize?Uint16Array.from(t.variableChunkSize):void 0,b=m?m.byteLength:0,_=s.byteLength+b+o+h+u+l+c+f+p+d+y+g,v=0,M=0;if(t.harmonics&&t.harmonics.length>0)for(let k=0;k<t.harmonics.length;k++)v+=t.harmonics[k].quantized.data.buffer.byteLength,M+=t.harmonics[k]instanceof V?i:0;v=0,M=0,_+=v+M;let w=new Uint8Array(_),x=0;if(w.set(s,x),x+=s.byteLength,b>0&&(w.set(new Uint8Array(m.buffer),x),x+=b),t.xyz instanceof V&&(w.set(new Uint8Array(t.xyz.minmaxMatrix.data.buffer),x),x+=i),w.set(new Uint8Array(t.xyz.quantized.data.buffer),x),x+=o,t.color instanceof V&&(w.set(new Uint8Array(t.color.minmaxMatrix.data.buffer),x),x+=i),w.set(new Uint8Array(t.color.quantized.data.buffer),x),x+=u,t.opacity instanceof V&&(w.set(new Uint8Array(t.opacity.minmaxMatrix.data.buffer),x),x+=i),w.set(new Uint8Array(t.opacity.quantized.data.buffer),x),x+=c,t.scaling instanceof V&&(w.set(new Uint8Array(t.scaling.minmaxMatrix.data.buffer),x),x+=i),w.set(new Uint8Array(t.scaling.quantized.data.buffer),x),x+=p,t.quaternion instanceof V&&(w.set(new Uint8Array(t.quaternion.minmaxMatrix.data.buffer),x),x+=i),w.set(new Uint8Array(t.quaternion.quantized.data.buffer),x),x+=y,v>0&&t.harmonics&&t.harmonics.length>0)for(let k=0;k<t.harmonics.length;k++){let r=t.harmonics[k];r instanceof V&&(w.set(new Uint8Array(r.minmaxMatrix.data.buffer),x),x+=i),w.set(new Uint8Array(r.quantized.data.buffer),x),x+=r.quantized.data.byteLength}return new Pa(w.buffer)}}}}]);
//# sourceMappingURL=511.9040755f.js.map